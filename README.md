# EHEC_Marker

EPEC is defined as eae+ \
EHEC is defined as eae+ stx+ \
EAEC (pathogenic epidemic isolate only) is defined as stx+  or stx+/subA+ \
EAEC needs to have aggR+ \



## Tasks:
1. Identify all eae+ isolates
2. Find their linkage to stx, esp, ureD and z2098. Then create the linkage table.
3. Find aggR that are positive for stx or stx/subA
4. Find eae negative but stx+ isolates (STEC). STEC is not important for food safety. 


## Genes interested
```
eae (intimin; include a few alleles if you care about subtyping, e.g., β, γ, ε).
stx1 and stx2 (include major subtypes: stx1a/1c/1d; stx2a–2g to avoid false negatives).
espK, espV (T3SS effectors; often on OI-122 / related islands).
Z2098 (OI-122 marker; locus tag from the O157 Sakai island).
ureD (urease accessory subunit—present in some clades; include a couple of E. coli hits to avoid over-stringency).
```
`ehec_markers.fna`
```
>eae
ATGATTACTCATGGTTGTTATACCCGGACCCGGCACAAGCATAAGCTAAAAAAAACATTGATTATGCTTA
GTGCTGGTTTAGGATTGTTTTTTTATGTTAATCAGAATTCATTTGCAAATGGTGAAAATTATTTTAAATT
GGGTTCGGATTCAAAACTGTTAACTCATGATAGCTATCAGAATCGCCTTTTTTATACGTTGAAAACTGGT
GAAACTGTTGCCGATCTTTCTAAATCGCAAGATATTAATTTATCGACGATTTGGTCGTTGAATAAGCATT
TATACAGTTCTGAAAGCGAAATGATGAAGGCCGCGCCTGGTCAGCAGATCATTTTGCCACTCAAAAAACT
TCCCTTTGAATACAGTGCACTACCACTTTTAGGTTCGGCACCTCTTGTTGCTGCAGGTGGTGTTGCTGGT
CACACGAATAAACTGACTAAAATGTCCCCGGACGTGACCAAAAGCAACATGACCGATGACAAGGCATTAA
ATTATGCGGCACAACAGGCGGCGAGTCTCGGTAGCCAGCTTCAGTCGCGATCTCTGAACGGCGATTACGC
GAAAGATACCGCTCTTGGTATCGCTGGTAACCAGGCTTCGTCACAGTTGCAGGCCTGGTTACAACATTAT
GGAACGGCAGAGGTTAATCTGCAGAGTGGTAATAACTTTGACGGTAGTTCACTGGACTTCTTATTACCGT
TCTATGATTCCGAAAAAATGCTGGCATTTGGTCAGGTCGGAGCGCGTTACATTGACTCCCGCTTTACGGC
AAATTTAGGTGCGGGTCAGCGTTTTTTCCTTCCTGCAAACATGTTGGGCTATAACGTCTTCATTGATCAG
GATTTTTCTGGTGATAATACCCGTTTAGGTATTGGTGGCGAATACTGGCGAGACTATTTCAAAAGTAGCG
TTAACGGCTATTTCCGCATGAGCGGCTGGCATGAGTCATACAATAAGAAAGACTATGATGAGCGCCCAGC
AAATGGCTTCGATATCCGTTTTAATGGCTATCTACCGTCATATCCGGCATTAGGCGCCAAGCTGATATAT
GAGCAGTATTATGGTGATAATGTTGCTTTGTTTAATTCTGATAAGCTGCAGTCGAATCCTGGTGCGGCGA
CCGTTGGTGTAAACTATACTCCGATTCCTCTGGTGACGATGGGGATCGATTACCGTCATGGTACGGGTAA
TGAAAATGATCTCCTTTACTCAATGCAGTTCCGTTATCAGTTTGATAAATCGTGGTCTCAGCAAATTGAA
CCACAGTATGTTAACGAGTTAAGAACATTATCAGGCAGCCGTTACGATCTGGTTCAGCGTAATAACAATA
TTATTCTGGAGTACAAGAAGCAGGATATTCTTTCTCTGAATATTCCGCATGATATTAATGGTACTGAACA
CAGTACGCAGAAGATTCAGTTGATCGTTAAGAGCAAATACGGTCTGGATCGTATCGTCTGGGATGATAGT
GCATTACGCAGTCAGGGCGGTCAGATTCAGCATAGCGGAAGCCAAAGCGCACAAGACTACCAGGCTATTT
TGCCTGCTTATGTGCAAGGTGGCAGCAATATTTATAAAGTGACGGCTCGCGCCTATGACCGTAATGGCAA
TAGCTCTAACAATGTACAGCTTACTATTACCGTTCTGTCGAATGGTCAAGTTGTCGACCAGGTTGGGGTA
ACGGACTTTACGGCGGATAAGACTTCGGCTAAAGCGGATAACGCCGATACCATTACTTATACCGCGACGG
TGAAAAAGAATGGGGTAGCTCAGGCTAATGTCCCTGTTTCATTTAATATTGTTTCAGGAACTGCAACTCT
TGGGGCAAATAGTGCCAAAACGGATGCTAACGGTAAGGCAACCGTAACGTTGAAGTCGAGTACGCCAGGA
CAGGTCGTCGTGTCTGCTAAAACCGCGGAGATGACTTCAGCACTTAATGCCAGTGCGGTTATATTTTTTG
ATCAAACCAAGGCCAGCATTACTGAGATTAAGGCTGATAAGACAACTGCAGTAGCAAATGGTAAGGATGC
TATTAAATATACTGTAAAAGTTATGAAAAACGGTCAGCCAGTTAATAATCAATCCGTTACATTCTCAACA
AACTTTGGGATGTTCAACGGTAAGTCTCAAACGCAAGCAACCACGGGAAATGATGGTCGTGCGACGATAA
CACTAACTTCCAGTTCCGCCGGTAAAGCGACTGTTAGTGCGACAGTCAGTGATGGGGCTGAGGTTAAAGC
GACTGAGGTCACTTTTTTTGATGAACTGAAAATTGACAACAAGGTTGATATTATTGGTAACAATGTCAGA
GGCGAGTTGCCTAATATTTGGCTGCAATATGGTCAGTTTAAACTGAAAGCAAGCGGTGGTGATGGTACAT
ATTCATGGTATTCAGAAAATACCAGTATCGCGACTGTCGATGCATCAGGGAAAGTCACTTTGAATGGTAA
AGGCAGTGTCGTAATTAAAGCCACATCTGGTGATAAGCAAACAGTAAGTTACACTATAAAAGCACCGTCG
TATATGATAAAAGTGGATAAGCAAGCCTATTATGCTGATGCTATGTCCATTTGCAAAAATTTATTACCAT
CCACACAGACGGTATTGTCAGATATTTATGACTCATGGGGGGCTGCAAATAAATATAGCCATTATAGTTC
TATGAACTCAATAACTGCTTGGATTAAACAGACATCTAGTGAGCAGCGTTCTGGAGTATCAAGCACTTAT
AACCTAATAACACAAAACCCTCTTCCTGGGGTTAATGTTAATACTCCAAATGTCTATGCGGTTTGTGTAG
AATAA
>stx1B
ATGAAAAAAACATTATTAATAGCTGCATCGCTTTCATTTTTTTCAGCAAGTGCGCTGGCGACGCCTGATT
GTGTAACTGGAAAGGTGGAGTATACAAAATATAATGATGACGATACCTTTACAGTTAAAGTGGGTGATAA
AGAATTATTTACCAACAGATGGAATCTTCAGTCTCTTCTTCTCAGTGCGCAAATTACGGGGATGACTGTA
ACCATTAAAACTAATGCCTGTCATAATGGAGGGGGATTCAGCGAAGTTATTTTTCGTTGA
>stx1A
ATGAAAATAATTATTTTTAGAGTGCTAACTTTTTTCTTTGTTATCTTTTCAGTTAATGTGGTTGCGAAGG
AATTTACCTTAGACTTCTCGACTGCAAAGACGTATGTAGATTCGCTGAATGTCATTCGCTCTGCAATAGG
TACTCCATTACAGACTATTTCATCAGGAGGTACGTCTTTACTGATGATTGATAGTGGCACAGGGGATAAT
TTGTTTGCAGTTGATGTCAGAGGGATAGATCCAGAGGAAGGGCGGTTTAATAATCTACGGCTTATTGTTG
AACGAAATAATTTATATGTGACAGGATTTGTTAACAGGACAAATAATGTTTTTTATCGCTTTGCTGATTT
TTCACATGTTACCTTTCCAGGTACAACAGCGGTTACATTGTCTGGTGACAGTAGCTATACCACGTTACAG
CGTGTTGCAGGGATCAGTCGTACGGGGATGCAGATAAATCGCCATTCGTTGACTACTTCTTATCTGGATT
TAATGTCGCATAGTGGAACCTCACTGACGCAGTCTGTGGCAAGAGCGATGTTACGGTTTGTTACTGTGAC
AGCTGAAGCTTTACGTTTTCGGCAAATACAGAGGGGATTTCGTACAACACTGGATGATCTCAGTGGGCGT
TCTTATGTAATGACTGCTGAAGATGTTGATCTTACATTGAACTGGGGAAGGTTGAGTAGTGTCCTGCCTG
ATTATCATGGACAAGACTCTGTTCGTGTAGGAAGAATTTCTTTTGGAAGCATTAATGCAATTCTGGGAAG
CGTGGCATTAATACTGAATTGTCATCATCATGCATCGCGAGTTGCCAGAATGGCATCTGATGAGTTTCCT
TCTATGTGTCCGGCAGATGGAAGAGTCCGTGGGATTACGCACAATAAAATATTGTGGGATTCATCCACTC
TGGGGGCAATTCTGATGCGCAGAACTATTAGCAGTTGA
>stx2A
ATGAAGTGTATATTATTTAAATGGGTACTGTGCCTGTTACTGGGTTTTTCTTCGGTATCCTATTCCCGGG
AGTTTACGATAGACTTTTCGACCCAACAAAGTTATGTCTCTTCGTTAAATAGTATACGGACAGAGATATC
GACCCCTCTTGAACATATATCTCAGGGGACCACATCGGTGTCTGTTATTAACCACACCCCACCGGGCAGT
TATTTTGCTGTGGATATACGAGGGCTTGATGTCTATCAGGCGCGTTTTGACCATCTTCGTCTGATTATTG
AGCAAAATAATTTATATGTGGCCGGGTTCGTTAATACGGCAACAAATACTTTCTACCGTTTTTCAGATTT
TACACATATATCAGTGCCCGGTGTGACAACGGTTTCCATGACAACGGACAGCAGTTATACCACTCTGCAA
CGTGTCGCAGCGCTGGAACGTTCCGGAATGCAAATCAGTCGTCACTCACTGGTTTCATCATATCTGGCGT
TAATGGAGTTCAGTGGTAATACAATGACCAGAGATGCATCCAGAGCAGTTCTGCGTTTTGTCACTGTCAC
AGCAGAAGCCTTACGCTTCAGGCAGATACAGAGAGAATTTCGTCAGGCACTGTCTGAAACTGCTCCTGTG
TATACGATGACGCCGGGAGACGTGGACCTCACTCTGAACTGGGGGCGAATCAGCAATGTGCTTCCGGAGT
ATCGGGGAGAGGATGGTGTCAGAGTGGGGAGAATATCCTTTAATAATATATCAGCGATACTGGGGACTGT
GGCCGTTATACTGAATTGCCATCATCAGGGGGCGCGTTCTGTTCGCGCCGTGAATGAAGAGAGTCAACCA
GAATGTCAGATAACTGGCGACAGGCCTGTTATAAAAATAAACAATACATTATGGGAAAGTAATACAGCTG
CAGCGTTTCTGAACAGAAAGTCACAGTTTTTATATACAACGGGTAAATAA
>stx2B
ATGAAGAAGATGTTTATGGCGGTTTTATTTGCATTAGCTTCTGTTAATGCAATGGCGGCGGATTGTGCTA
AAGGTAAAATTGAGTTTTCCAAGTATAATGAGGATGACACATTTACAGTGAAGGTTGACGGGAAAGAATA
CTGGACCAGTCGCTGGAATCTGCAACCGTTACTGCAAAGTGCTCAGTTGACAGGAATGACTGTCACAATC
AAATCCAGTACCTGTGAATCAGGCTCCGGATTTGCTGAAGTGCAGTTTAATAATGACTGA
>espK
ATGCTTCCTACATCGCAATTACGACCGACCGGGACATTCTGCTCCTATTCCGCTGAAACATCAGCAGACA
TCAAAAGCGAAATCACACCAATTCAGATAGAAGAAGCGCGGGCCAGTGGTCGTTTATATATCAAAGATTG
TGATATTGAGTATCTGCCACAGTTACCAAACGAAATAACATCAGTTACAATCGAAAACTGCAACAACCTG
ACAACCCTTACAGGATTGCCGGTTAATACACAAAACCTCTCCGTCATTAACTGTGAAAAATTACAAATCA
CAGACATGCCATCAACCGTAAAAAATCTACATATTGAATTAACTGATTCACCATTTATACATTTCATATC
TGAAGGCATCGAGTGCCTGACGGTTTGCCACTGCTATATATCTGGAGTGCCAGAGAGTGTCCGCTACCTT
GAAATAAAAGGTAGCGCCACAGACAGCATAAAAAATGTTCCAAACGGGTTATCATCTCTCAGCATCAATA
GCTATAACCCGGAGAATCAGGCCAGAATTGACAACCTGATATCACCGTCACTGAAGACGCTATCGCTGAC
TGGATGTAGCAATATTATACTGCCGGAGAAACTTCCGGAGAGTGTGACATCGGTAACCATTCATGCGGAG
CAGAAAACCACGTGGAACATCGGTGTTGAAGGGATGCCTGATGGGCTGGATCTTGATTTACAAAATGTAC
TACTCTCTCCAGATGTAGTTAAAGCAAAAAACATCACCTTTCAGGGCAACGCTCTGGATGTGGCCTTACA
CTTTCGCGAGGGAGACATTGTCTATGGACTATCTTCACCCAGAGAAAAACTTGTCAACAGCATTAAACTA
GTTAACGACTTTTCCAAAAAAGATATTATAACTCAGAATACGTTAACAAACGCAGTATGGGACCCCAGAA
CACCTCGCAAATATAAGCAAGATCCACTTATCAAAAGAGCATTAAATGAACACGAAAGAGGAATAAAATT
TAAACAACACTTAAAGAATCACAATAATTATAATGTTACCATGGCCGACCTTTCCGTATACAATCGCGAC
AAATTATGGGCAAAAACAAGCAAGGCCGGCCTAGAGTTTCAGACATTAACACGCAATAAAACGGTTATTT
TTTGTGCGGATGAGCTTGTCAACTCACTCAAACTCATAGCTAACAAGTCAGAGGGCTATGGCCAGAGTAT
TACCGCCAGCGAATTACGATGGATTTACCGTAATAAAGACAACAACCAAATAATGAAAAACATAAAATTT
TATCTACATGGCAAAGAGATACCAGCAGAAAGAATATTAGATACACCAGAATGGAAAGACTATCGTCCAA
AATACTCTGGTTCCACATATAAATATTCTTAA
>espV
ATGAGCGGAACCTCAGGTTCCTCGTCTGATGCCGCTCTTGCAACACGTTACGCTGCCGAGTATTTTTGTA
AAACATGGACTGCTCCAGGCCTGAACCAGGCAGAAGGATACAAAGCCATCTCAGATCTGTCGCATCACTA
TTTTCGTGCAGAAGGCTCTAGCCCTCCCCAATCTTTTTTGTGA
>Z2098
ATGAGCACTATTACCAGAGAACGCGCGGAGATTAAATCATACATCACAGGCTTCCTGAGCGACTCGGCGC
ACGATAACAAGTCTTCAGACAGCCTGCTGGCTAATGTGTTTCGTATCGCGCTGGCATCACTGGAAGCAGA
GCCGATAGCAATGGTAGTGCCTGATGAAATGGATTTGCTTACCTGCCATCTCGACGGTGTAACTAAAACA
TATGCTGATGGCTGGAACGCCTGCCGCGTCGCCATGCTTCAGGCCGGAAACTTTCGGGAAAATAAGAATT
CGTCAACCAACAATTTTCGGGAAATCTCGGAAACGTCAACCAGATCTCCGATAACTCTGGATGGCTGGAT
AAGCTGTACTGAGCGAATGCCTGAAAAGAGCCAGAACGTGCTTATTTCGATGAATATCGATAGCGAGGCT
GGGCCATTAATATATTCCGCACGCTATCTCGGAGGCACGTTCCGGCGCGGAGGTATAGCAGTTAGTCCGG
GTAATGATCTTAGGCAAGCAACCCACTGGATGTCGCTACCAGAACCGCCGCAGGAGGTGAATCAATGA
>ureD
ATGCTGGATCTCCGTTTTCAGCGTCTGCACGGGAAAACCACGCTCACCACCCGTCATCATGTCGGTCTGC
TCACTGTTCAGCGTCCTTTTTATCCCGAAGAAGAAACCTGCCACCTCTGTCTGCTTCATCCACCCGGTGG
TATCGTCGGCGGTGACGAACTCATCATCAACGCAATAATTGACTCTGATTGCCATACGCTGATCACCATG
CCTGGTGCCAGTAAATTTTACCGCAGCAGCGGCGCGCAGGCGCACCTTCAGCAAAACCTGACGCTGTGCA
ATAACGCAACGCTGGAGTGGTTGCCACAGGATTCGATTTTTTTTCCCGGCGCTCACGCCACGTTGCATAC
CGTGTTTCATCTGTCGTCCTCCAGTACACTGCTGGCCTGGGATCTTCTGTGCCTTGGACGTCCGGTCATC
GGAGAAACCTTCAGCCACGGAACACTCGCTAACCGTCTGGAGATATGGGTCGACGGTTCTCCGCTGTTGA
TTGAGCGTCTGCACGTGGCCAATGGAGAACTTACCTGCGTTGCCCGGAAACCATGGGTGGGAACGATGCT
GTTCTACCTGGGGAATGAAACGCAACTGGAAGACATACGCGAAAAACTCACACCACTGGAAAACTACGCC
GGAGCCACGCTCACCGATGGTCTACTGACAGTTCGCTTTTTAAGTGATGATAATCTGCGTTGCCAGTAG
```
## Download assemblies from NCBI
### Top 7 EHEC Strains
O157:H7
O26:H11
O45:H2
O103:H2
O111:H8
O121:H19
O145:H28
```
# Get ALL complete genomes for Escherichia coli 
./datasets download genome taxon "Escherichia coli O157:H7" \
  --assembly-level complete \
  --filename o157_complete.zip

./datasets download genome taxon "Escherichia coli O26:H11" \
  --filename o26_complete.zip

./datasets download genome taxon "Escherichia coli O45:H2" \
  --assembly-level complete \
  --filename o45_complete.zip

./datasets download genome taxon "Escherichia coli O103:H2" \
  --assembly-level complete \
  --filename o103_complete.zip

./datasets download genome taxon "Escherichia coli O111:H8" \
  --assembly-level complete \
  --filename o111_complete.zip

./datasets download genome taxon "Escherichia coli O121:H19" \
  --assembly-level complete \
  --filename o121_complete.zip

./datasets download genome taxon "Escherichia coli O145:H28" \
  --assembly-level complete \
  --filename o145_complete.zip

unzip o157_ref.zip -d o157_assemblies
```

### EPEC Strains
```
./datasets download genome taxon "Escherichia coli O55:H7" \
  --assembly-level complete \
  --filename o55_complete.zip

./datasets download genome taxon "Escherichia coli O127:H6" \
  --assembly-level complete \
  --filename o127_complete.zip

./datasets download genome taxon "Escherichia coli O26:H11" \
  --assembly-level complete \
  --filename o26_H11_complete.zip

./datasets download genome taxon "Escherichia coli O111:H2" \
  --assembly-level complete \
  --filename o111_H2_complete.zip

./datasets download genome taxon "Escherichia coli O142:H6" \
  --assembly-level complete \
  --filename o142_complete.zip


```
## Change file name
```
for d in EHEC_*; do
  [ -d "$d" ] || continue
  folder=$(basename "$d")
  cd "$d"
  for f in *.fna; do
    mv "$f" "${folder}_${f}"
  done
  cd ..
done

for d in EPEC_*; do
  [ -d "$d" ] || continue
  folder=$(basename "$d")
  cd "$d"
  for f in *.fna; do
    mv "$f" "${folder}_${f}"
  done
  cd ..
done

```
```
DEST_DIR="assembly"
# Loop through each folder and copy its contents

for folder in EHEC_*; do
    if [ -d "$folder" ]; then
        cp "$folder"/* "$DEST_DIR"/
    fi
done
```

# ABRicate with a custom DB:
```
mkdir -p /home/jing/miniconda3/envs/abricate/db/ehec_markers
cp ehec_markers.fna /home/jing/miniconda3/envs/abricate/db/ehec_markers/sequences
abricate --setupdb

mkdir -p abricate_out
find all_sample -type f -name "*.fna" -print0 \
| while IFS= read -r -d '' f; do
  base=$(basename "$f" .fna)
  echo "[ABRicate] $base"
  abricate --db ehec_markers --minid 98 --mincov 90 "$f" > "abricate_out/${base}.tsv"
done

abricate --summary abricate_out/*.tsv > abricate_summary.tsv
echo "Wrote abricate_summary.tsv"
```

